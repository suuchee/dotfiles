# CLAUDE.md

## 基本ポリシー

1. 回答は必ず日本語で行う。
2. 実装に入る前に、必ず下記を明確化・設計する。設計する場合は `Plan` モードに切り替える。
   * 目的・背景・前提条件
   * 全体設計
   * ブランチ戦略・ブランチ設計
   * コミット設計
3. 不明点や判断基準が曖昧な箇所は `AskUserQuestion` を使用して必ず質問し、クリアにしてから着手する。
4. 違和感・矛盾を見つけた場合は必ず報告する。
5. 常にあなたの知識は古い可能性があることを認識し、特に外部サービスやライブラリを利用しているコードの作成・変更を行う場合は、以下の手順で調査する。
   1. Context7または公式ドキュメントに直接アクセスし、最新仕様を確認
   2. 調査結果は実装根拠として `.workspace/context/<NNN>_<context-name>/research/<対象名>_YYYY-MM-DD.md` に保存
      * 一度保存した記録は過去の記録として価値があるため、メンテナンス不要
6. 対話中の要望や要件に関わる情報を常に `.workspace/context/<NNN>_<context-name>/requirements/requirements_YYYY-MM-DD.md` に記録する。
7. 検討したことは再度検討しなくていいよう `.workspace/context/<NNN>_<context-name>/deliberation/deliberation_YYYY-MM-DD.md` にメモする。

## .workspace/context

作業コンテキスト（ブランチ相当の作業単位）を管理するディレクトリ。
詳細は `~/.claude/rules/workspace-context.md` を参照。

## 設計・実装ポリシー

### 優先順位

設計・実装の判断は以下の順で従う：

1. **プロジェクト固有のルール** - CLAUDE.md、コーディング規約、ADR など明文化されたもの
2. **既存コードベースのパターン** - 類似実装が既にあればそれに従う
3. **一般的なベストプラクティス** - 上記がない場合に適用

### コロケーション（Colocation）

関連するコードは近くに配置し、理解しやすく保守しやすい構造を維持する。

* 機能に必要なファイル（コンポーネント、スタイル、テスト、型定義、ユーティリティ）は同じディレクトリにまとめる
* 特定の機能でしか使わないものをグローバルな共通ディレクトリに置かない
* ディレクトリ構造を見ただけで、その機能の全体像が把握できる状態を目指す

### 共通化と再利用

実装前に既存資産を確認し、重複を避けて一貫性を保つ。

* **実装前の確認事項**
  * 既存のコンポーネント、ユーティリティ、型定義で流用できるものはないか
  * 類似の実装パターンがコードベースに存在しないか
* **計画段階での考慮**
  * 再利用可能な部品を特定し、計画に盛り込む
  * 共通化によるメリット（保守性、一貫性）とデメリット（過度な抽象化）を検討
* **新規作成時の判断基準**
  * 3箇所以上で使われる見込みがあれば共通化を検討
  * ただし、現時点で1箇所でしか使わないものを「将来のため」に共通化しない（YAGNI原則）
* **既存パターンの確認**
  * 類似の実装が既にあるか確認し、あればそのパターンに従う
  * なければ一般原則に従いつつ、周辺コードのスタイルを参考にする
  * 補助的に：ディレクトリ構成の一貫性、共通部品の整備状況も考慮
* **共通化のタイミング**
  * 共通化・リファクタリングは機能実装と混ぜず、別工程として行う
  * コミットまたはブランチを分け、変更の意図を明確にする
